# 動作確認チェックリスト（2025年1月24日）

## ユーザー登録関連

### 新規登録
- [ ] 新規登録フォームが正常に表示される
- [ ] 確認画面が表示される
- [ ] 仮登録完了メールが送信される
- [ ] メールアドレス重複チェックが機能する（仮登録・本登録両方）

### アクティベーション
- [ ] アクティベーションリンクから本登録が完了する
- [ ] 1時間以内なら正常にアクティベーションできる
- [ ] 1時間経過後は「有効期限切れ」エラーが表示される
- [ ] '0000-00-00 00:00:00'問題が解決されている

### 仮登録クリーンアップ
- [ ] 管理画面から手動クリーンアップが実行できる（/admin/clean_interim_users.php）
- [ ] 期限切れユーザーの統計が正しく表示される
- [ ] cronスクリプトが正常に動作する（/cron/clean_interim_users.php）

## データベース関連

### regist_date問題
- [ ] /admin/fix_regist_date_null.php で修正ツールが動作する
- [ ] '0000-00-00 00:00:00'のデータがNULLに変換される
- [ ] regist_dateカラムがNULL許可になる

### 日付型チェック
- [ ] /admin/check_datetime_issues.php で問題診断ができる
- [ ] 問題のあるテーブル・カラムが正しく表示される

## 管理画面

### メニュー・ナビゲーション
- [ ] ユーザー管理サブメニューに「仮登録ユーザー管理」が表示される
- [ ] データベース管理サブメニューに新しいツールが表示される
- [ ] トップページから新しいツールにアクセスできる

### セキュリティ
- [ ] 403エラーページにメールアドレスが表示されない
- [ ] 管理者以外はアクセスできない

## メール送信

### メール設定確認
- [ ] /admin/check_mail_config.php でメール設定が確認できる
- [ ] テストメール送信が機能する

## cron設定（推奨）

```bash
# 10分ごとに実行（1時間経過した仮登録ユーザーを削除）
*/10 * * * * /usr/bin/php /path/to/readnest/cron/clean_interim_users.php

# その他の既存cron設定も継続
```

## 注意事項

1. **メール送信について**
   - mb_send_mail()は成功を返すが、実際の配送はサーバー設定に依存
   - SPFレコードの設定確認が必要
   - 迷惑メールフォルダの確認を促す

2. **データベース修正**
   - regist_dateの修正は一度だけ実行
   - バックアップを取ってから実行を推奨

3. **今後の課題**
   - メール送信のより詳細なログ機能
   - 仮登録ユーザーへのリマインダー機能
   - 管理画面でのメール送信状況の可視化

## ユーザー登録ログ機能（2025年1月25日追加）

### ロギング機能
- [ ] 仮登録開始がログに記録される
- [ ] 仮登録成功/失敗がログに記録される
- [ ] メール送信成功/失敗がログに記録される
- [ ] アクティベーション試行がログに記録される
- [ ] アクティベーション成功/失敗がログに記録される
- [ ] 重複登録試行がログに記録される
- [ ] 期限切れアクティベーションがログに記録される

### メール通知
- [ ] 仮登録エラー時にadmin@readnest.jpに通知される
- [ ] メール送信失敗時にadmin@readnest.jpに通知される
- [ ] 新規ユーザー登録完了時にadmin@readnest.jpに通知される

### 管理画面
- [ ] /admin/registration_logs.php でログが確認できる
- [ ] 統計情報（登録開始、仮登録成功、本登録完了など）が表示される
- [ ] 期間別（今日/過去7日/過去30日）でフィルタリングできる
- [ ] 最近のログエントリが表示される
- [ ] ログファイルがダウンロードできる

### ログファイル
- [ ] /logs/registration/YYYY-MM_registration.log にログが保存される
- [ ] ログファイルが月単位でローテーションされる
- [ ] ログにタイムスタンプ、レベル、イベント、IPアドレス、詳細データが記録される